import{Q as le,a as ae}from"./QItem-CudS6pm4.js";import{Q as pe,a as ve}from"./rtl-BrqEfou-.js";import{d as I,o as i,V as D,ac as P,a as o,aO as U,i as T,q as F,m as ye,R as ge,c as u,w as s,Y as C,f as g,g as K,_ as h,Q as H,b as w,h as Te,l as W,e as ee,aa as ke,L as X,j as B,an as Ce,aP as we,a8 as J,p as re,s as Y,t as Z,z as xe,n as S,aQ as Oe,k as z,$ as qe}from"./index-CpMs11Xl.js";import{u as Se}from"./use-quasar-q8BiYS6n.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as de}from"./QForm-Bhl5ku3_.js";import{a as G,b as he,Q as $e,c as oe}from"./QTable-DWnKMcJt.js";import{C as se,Q as Me}from"./CodeMaker-3r3752K-.js";import"./format-D1eNeEqU.js";import"./_commonjsHelpers-Bx2EM-6T.js";const Ee={class:"tabs row q-gutter-sm"},Qe={__name:"FilterTabs",props:{filterStatus:String},setup(e){const b=e,c=[{label:"Todos",value:"Todos"},{label:"Livre",value:"Livre"},{label:"Ocupado",value:"Ocupado"},{label:"Reservado",value:"Reservado"},{label:"Pago",value:"Pago"}];function n(p){if(p===b.filterStatus)switch(p){case"Livre":return"bg-green text-white";case"Ocupado":return"bg-red text-white";case"Reservado":return"bg-blue text-white";case"Pago":return"bg-grey-6 text-white";case"Todos":default:return"bg-black text-white"}return"bg-white text-black"}return(p,r)=>(i(),I("div",Ee,[(i(),I(D,null,P(c,d=>o(T,{key:d.value,label:d.label,flat:e.filterStatus!==d.value,unelevated:!0,class:U(n(d.value)),onClick:t=>p.$emit("update:filterStatus",d.value)},null,8,["label","flat","class","onClick"])),64))]))}},Ae={class:"text-h6 text-weight-bolder"},Ne={class:"status-text"},Be={class:"text-subtitle2 text-weight-bolder"},Ie={__name:"TableCard",props:{table:Object,editMode:Boolean},setup(e){const b=e,c=F(()=>parseFloat(b.table.order.reduce((p,r)=>p+r.price*r.quantity,0).toFixed(2))),n=F(()=>{switch(b.table.status){case"Livre":return"status-free";case"Ocupado":return"status-busy";case"Reservado":return"status-reserved";case"Pago":return"status-paid";default:return""}});return(p,r)=>ye((i(),u(H,{class:U(["table-card",n.value,"my-card","text-center","q-pa-md"]),flat:"",bordered:"",onClick:r[1]||(r[1]=()=>p.$emit("selectTable",e.table.id))},{default:s(()=>[e.editMode?(i(),u(T,{key:0,icon:"close",size:"xl",color:"red",flat:"",round:"",class:"central-delete-btn",onClick:r[0]||(r[0]=K(()=>p.$emit("removeTable",e.table.id),["stop"]))})):C("",!0),g("div",null,[g("div",Ae," Mesa "+h(e.table.id),1),g("div",Ne,h(e.table.status),1),g("div",null,h(e.table.people)+" Pessoas ",1),g("div",Be," €"+h(c.value),1)])]),_:1},8,["class"])),[[ge]])}},Le=te(Ie,[["__scopeId","data-v-30f5901c"]]),Ve={class:"table-grid q-pa-lg"},Fe={__name:"TableGrid",props:{tables:Array,editMode:Boolean},setup(e){return(b,c)=>(i(),I("div",Ve,[(i(!0),I(D,null,P(e.tables,n=>(i(),u(Le,{key:n.id,table:n,editMode:e.editMode,onSelectTable:()=>b.$emit("selectTable",n.id),onRemoveTable:()=>b.$emit("removeTable",n.id)},null,8,["table","editMode","onSelectTable","onRemoveTable"]))),128))]))}},Re=te(Fe,[["__scopeId","data-v-acb55136"]]),je={__name:"AddTableForm",props:{visible:Boolean},emits:["submit","update:visible","close"],setup(e,{emit:b}){const c=b,n=w("");function p(){c("submit",n.value),n.value=""}return(r,d)=>(i(),u(ee,{"model-value":e.visible,onHide:d[2]||(d[2]=()=>r.$emit("close"))},{default:s(()=>[o(H,{style:{"min-width":"400px"}},{default:s(()=>[o(de,{onSubmit:p},{default:s(()=>[o(Te,{filled:"",modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=t=>n.value=t),type:"number",label:"Número da mesa",hint:"Número da mesa","lazy-rules":"",rules:[t=>t&&t.length>0||"Por favor, escreve algo",t=>!isNaN(t)||"Conteúdo tem ser um número"]},null,8,["modelValue","rules"]),o(W,{align:"right"},{default:s(()=>[g("div",null,[o(T,{label:"Submeter",type:"submit",color:"primary"}),o(T,{label:"Cancelar",type:"cancel",color:"primary",flat:"",class:"q-ml-sm",onClick:d[1]||(d[1]=K(()=>r.$emit("close"),["stop"]))})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},ze={class:"q-mt-none q-mb-none text-center"},De={class:"self-center no-outline"},Ue={round:"",class:"self-center no-outline"},_e={class:"self-center no-outline"},Pe={class:U(["col-4","justify-between","row"])},He={__name:"TableDetail",props:{visible:Boolean,table:Object,editable:Boolean},emits:["submit","close","tableEditableMode","editableModeBack","showTableOrders","cleanTable"],setup(e,{emit:b}){const c=e,n=w(!0),p=["Livre","Ocupado","Pago","Reservado"],r=b,d=w(null),t=ke({id:null,people:0,peopleType:{adults:0,childres:0},status:""});function M(){t.peopleType.adults>0&&(t.peopleType.adults=t.peopleType.adults-1)}function O(){t.peopleType.adults=t.peopleType.adults+1}function Q(){t.peopleType.childres>0&&(t.peopleType.childres=t.peopleType.childres-1)}function R(){t.peopleType.childres=t.peopleType.childres+1}function j(){window.open(window.global_qr_addr+se.SimpleEncode(c.table.id),"_blank")}X(()=>c.visible,async k=>{k&&c.table?.id&&(Object.assign(t,JSON.parse(JSON.stringify(c.table))),await J(),L(),t.status==="Livre"&&(await J(),r("tableEditableMode")))},{immediate:!0}),X(()=>[t.peopleType.adults,t.peopleType.childres],([k,m])=>{const $=parseInt(k)||0,l=parseInt(m)||0;t.people=$+l});async function L(){if(n.value=!0,await J(),!d.value||!c.table.id){console.warn("Canvas not ready or table ID missing");return}const k=window.global_qr_addr+se.SimpleEncode(c.table.id);console.log("qrcoed data: ",k),Me.toCanvas(d.value,k,{width:150},m=>{m?(console.error("二维码生成失败",m),setTimeout(()=>L(),300)):n.value=!1})}return(k,m)=>(i(),u(ee,{"model-value":e.visible,onHide:m[7]||(m[7]=$=>k.$emit("close"))},{default:s(()=>[o(H,{style:{"min-width":"450px"}},{default:s(()=>[o(B,{class:"row items-center justify-end q-pb-none q-pl-none q-pt-sm q-pr-sm"},{default:s(()=>[o(T,{icon:"close",flat:"",round:"",dense:"",onClick:m[0]||(m[0]=K($=>k.$emit("close"),["stop"]))})]),_:1}),o(de,{onSubmit:m[6]||(m[6]=()=>k.$emit("submit",t)),class:"q-ma-lg"},{default:s(()=>[g("h4",ze,"Table "+h(t.id),1),o(G,{outlined:"",label:"Adults","stack-label":"",class:"q-mx-sm col-grow"},{control:s(()=>[g("div",De,h(t.people),1)]),_:1}),o(B,{class:"row items-center"},{default:s(()=>[e.editable?(i(),u(T,{key:0,round:"",color:"primary",icon:"remove",padding:"xs",onClick:M})):C("",!0),o(G,{outlined:"",label:"Adults","stack-label":"",class:"q-mx-sm col-grow"},{control:s(()=>[g("div",Ue,h(t.peopleType.adults),1)]),_:1}),e.editable?(i(),u(T,{key:1,round:"",color:"primary",icon:"add",padding:"xs",onClick:O})):C("",!0)]),_:1}),o(B,{class:"row items-center no-wrap"},{default:s(()=>[e.editable?(i(),u(T,{key:0,round:"",color:"primary",icon:"remove",padding:"xs",onClick:Q})):C("",!0),o(G,{outlined:"",label:"Childrens","stack-label":"",class:"q-mx-sm col-grow"},{control:s(()=>[g("div",_e,h(t.peopleType.childres),1)]),_:1}),e.editable?(i(),u(T,{key:1,round:"",color:"primary",icon:"add",padding:"xs",onClick:R})):C("",!0)]),_:1}),o(he,{square:"",outlined:"",modelValue:t.status,"onUpdate:modelValue":m[1]||(m[1]=$=>t.status=$),options:p,disable:!e.editable},null,8,["modelValue","disable"]),o(B,{class:"flex flex-center",style:{"min-height":"160px"}},{default:s(()=>[n.value?(i(),u(Ce,{key:0,color:"primary",size:"2em"})):C("",!0),g("canvas",{ref_key:"qrCanvas",ref:d,style:we({display:n.value?"none":"block",marginTop:"8px",border:"1px solid #c0c0c0",borderRadius:"12px"}),onClick:j},null,4)]),_:1}),g("div",Pe,[t.status!="空闲"&&!e.editable?(i(),u(T,{key:0,color:"deep-orange",glossy:"",label:"Limpar mesa",onClick:m[2]||(m[2]=()=>k.$emit("cleanTable",t.id))})):C("",!0),e.editable?C("",!0):(i(),u(T,{key:1,color:"primary",label:"Visualizar pedidos",onClick:m[3]||(m[3]=()=>k.$emit("showTableOrders"))})),e.editable?C("",!0):(i(),u(T,{key:2,color:"secondary",label:"Editar",onClick:m[4]||(m[4]=()=>k.$emit("tableEditableMode"))})),e.editable?(i(),u(T,{key:3,color:"white","text-color":"black",label:"Cancelar",onClick:m[5]||(m[5]=()=>k.$emit("editableModeBack"))})):C("",!0),e.editable?(i(),u(T,{key:4,color:"primary",type:"submit",label:"Salvar"})):C("",!0)])]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Je=te(He,[["__scopeId","data-v-9a1a0a43"]]),ie=re({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:b}){const c=F(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>Y("tr",{style:e.props?.__trStyle,class:c.value},Z(b.default))}}),ne=re({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:b}){const c=xe(),n=F(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return Y("td",{class:n.value},Z(b.default));const p=c.vnode.key,r=(e.props.colsMap!==void 0?e.props.colsMap[p]:null)||e.props.col;if(r===void 0)return;const{row:d}=e.props;return Y("td",{class:n.value+r.__tdClass(d),style:r.__tdStyle(d)},Z(b.default))}}}),Ge={class:"text-h6"},We={class:"text-subtitle2",style:{"text-align":"left",width:"100%"}},Xe={__name:"OrderModal",props:{visible:Boolean,editMode:Boolean,table:{type:Object,default:()=>({id:null,peopleType:{adults:0,children:0},order:[]})}},emits:["cancelOrderEdit","setEditMode","saveOrder","close","autoClose","deleteOrder"],setup(e,{emit:b}){const c=e,n=b,p=w({rowsPerPage:0}),r=w(""),d=w(!1),t=w([]),M=[{name:"name",required:!0,label:"nome",align:"left",field:l=>S.getDishName(l),format:l=>`${l}`,sortable:!0},{name:"quantity",required:!0,label:"quandidade",align:"left",field:l=>l.quantity,format:l=>`${l}`,sortable:!0},{name:"price/uni",required:!0,label:"Preço/uni",align:"left",field:l=>l.price.toFixed(2),format:l=>`${l}`,sortable:!0},{name:"price",required:!0,label:"Preço",align:"left",field:l=>l.price*l.quantity,format:l=>`${l.toFixed(2)}`,sortable:!0},{name:"extras",required:!0,label:"Extras",field:l=>Q(l),format:l=>l||""}],O=w([]);function Q(l){return l.name.toLowerCase().includes("pato")?[l.notes[0],l.notes[1],l.notes[2]].filter(v=>!!v).join(" / "):l.name.toLowerCase().includes("ramen")&&l.notes[4]||""}X(()=>c.table?.order,l=>{t.value=Array.isArray(l)?JSON.parse(JSON.stringify(l)):[]},{immediate:!0,deep:!0});function R(l){return d.value?l.filter(v=>v.price>0):l}function j(){d.value&&(r.value=d.value?"price>0":"")}function L(){$(),d.value=!1,n("autoClose")}function k(l){const v=l.name==="XIAOXIONG® RAMEN",y=(A,E)=>A.findIndex(N=>v?N.name===E.name&&N.price===E.price:N.dishid===E.dishid),q=y(t.value,l);if(q===-1)return;const V=t.value[q];if(V.quantity<=0)return;if(V.quantity-=1,V.quantity===0){const A=t.value.splice(q,1)[0];_(A)}else _(V,l);function _(A,E=A){const N=y(O.value,A);N!==-1?O.value[N].quantity+=1:O.value.push({dishid:E.dishid,quantity:1,name:E.name,price:E.price})}}const m=F(()=>parseFloat(t.value.reduce((l,v)=>l+v.price*v.quantity,0).toFixed(2)));function $(){t.value=Array.isArray(c.table.order)?JSON.parse(JSON.stringify(c.table.order)):[],O.value=[],n("cancelOrderEdit")}return(l,v)=>(i(),u(ee,{"model-value":e.visible,onHide:L},{default:s(()=>[o(H,{style:{"min-width":"300px","max-height":"70%","max-width":"80%"}},{default:s(()=>[o(B,null,{default:s(()=>[g("div",Ge,"Mesa "+h(e.table.id),1)]),_:1}),Array.isArray(t.value)&&t.value.length>0?(i(),u(B,{key:0,class:"q-pa-md"},{default:s(()=>[o($e,{class:"my-sticky-header-table",flat:"",bordered:"","hide-bottom":"",rows:t.value,"virtual-scroll":"",filter:r.value,"filter-method":R,columns:M,pagination:p.value,"onUpdate:pagination":v[0]||(v[0]=y=>p.value=y),"rows-per-page-options":[0],"row-key":"id"},Oe({_:2},[e.editMode?{name:"header",fn:s(y=>[o(ie,{props:y},{default:s(()=>[o(oe,{"auto-width":""}),(i(!0),I(D,null,P(y.cols,q=>(i(),u(oe,{key:q.name,props:y},{default:s(()=>[z(h(q.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"0"}:void 0,e.editMode?{name:"body",fn:s(y=>[o(ie,{props:y},{default:s(()=>[o(ne,{"auto-width":""},{default:s(()=>[o(T,{size:"sm",color:"accent",round:"",dense:"",icon:"remove",disable:y.row.quantity<=0,onClick:q=>k(y.row)},null,8,["disable","onClick"])]),_:2},1024),(i(!0),I(D,null,P(y.cols,q=>(i(),u(ne,{key:q.name,props:y},{default:s(()=>[z(h(q.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"1"}:void 0]),1032,["rows","filter","pagination"])]),_:1})):(i(),u(B,{key:1},{default:s(()=>v[5]||(v[5]=[z(" Nothing ")])),_:1,__:[5]})),o(W,{class:"q-gutter-sm",style:{display:"flex","justify-content":"space-between",padding:"8px 16px","border-top":"1px solid #ccc",position:"sticky",bottom:"0",background:"white","z-index":"10"}},{default:s(()=>[o(W,{class:"q-gutter-sm",style:{padding:"8px 16px"}},{default:s(()=>[g("div",We," Total: €"+h(m.value),1)]),_:1}),e.editMode?C("",!0):(i(),u(qe,{key:0,modelValue:d.value,"onUpdate:modelValue":v[1]||(v[1]=y=>d.value=y),color:"green",onClick:v[2]||(v[2]=y=>j()),label:"No Zero"},null,8,["modelValue"])),e.editMode?(i(),u(T,{key:1,color:"white","text-color":"black",label:"Cancelar",onClick:$})):C("",!0),e.editMode?(i(),u(T,{key:2,color:"primary",label:"Salvar",onClick:v[3]||(v[3]=y=>l.$emit("saveOrder",[...O.value]))})):C("",!0),e.editMode?C("",!0):(i(),u(T,{key:3,color:"primary",label:"Editar",onClick:v[4]||(v[4]=()=>l.$emit("setEditMode"))}))]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Ye={class:U(["tables-page","row","no-wrap","justify-between"])},rt={__name:"TablesPage",setup(e){const b=Se(),c=w("Livre"),n=w(!1),p=w(!1),r=w(null),d=w(!1),t=w(!1),M=w(!1),O=w(!1),Q=w({}),R=F(()=>c.value==="Todos"?S.tables.value:S.tables.value.filter(f=>f.status===c.value));function j(){n.value=!0}function L(){n.value==!0&&(n.value=!1)}function k(f){b.dialog({title:"Confimação de eliminação",message:`Tem certeza quer eliminar a mesa ${f} ? Esta operação não é recuperável.`,cancel:!0,persistent:!0}).onOk(()=>{const a=S.deleteTable(f);a!=null&&b.dialog({title:"Erro",message:a.message})})}function m(){p.value=!0}async function $(f){const a=await S.addNewTable(f);a!==void 0&&b.notify({title:a.title,type:"negative",message:a.message,position:"top-right",timeout:3e3,icon:"error"})}function l(){p.value=!1}function v(f){const a=S.tables.value.find(x=>x.id===f);r.value={...a,order:a?.order||[]},d.value=!0}function y(){t.value=!0}function q(f){const a={id:f.id,status:f.status,peopleType:{adults:f.peopleType.adults,childres:f.peopleType.childres}},x=S.updateTable(a);x&&b.dialog(x),t.value=!1}function V(){t.value=!1,d.value=!1}function _(){t.value=!1}function A(f){b.dialog({title:"Confirmação de limpeza",message:`Tem a certeza que deseja limpar a mesa ${f}? Isto irá remover todos os clientes e definir o estado como 'Livre'.`,cancel:!0,persistent:!0}).onOk(()=>{const a=S.tableClean(f);a&&b.dialog(a)})}function E(){const f=S.tables.value.find(a=>a.id===r.value.id);r.value={...f,order:f?.order||[]},M.value=!0}function N(){M.value=!1}function ue(){O.value=!0}function ce(f){S.deleteOrders(r.value.id,f),Q.value.order&&(S.deleteOrder(Q.value),Q.value={}),O.value=!1}function be(){S.refreshTables(),O.value=!1}function me(){M.value=!1}function fe({order:f,tableId:a}){Q.value={order:f,tableId:a}}return(f,a)=>(i(),I(D,null,[g("div",Ye,[o(Qe,{filterStatus:c.value,"onUpdate:filterStatus":a[0]||(a[0]=x=>c.value=x)},null,8,["filterStatus"]),o(T,{color:"primary",icon:n.value?"close":"edit",class:U(["q-pa-md"]),onClick:L},{default:s(()=>[n.value?C("",!0):(i(),u(pe,{key:0},{default:s(()=>[o(ve,{style:{"min-width":"100px"}},{default:s(()=>[o(le,{clickable:"",onClick:m},{default:s(()=>[o(ae,null,{default:s(()=>a[6]||(a[6]=[z("Adicionar")])),_:1,__:[6]})]),_:1}),o(le,{clickable:"",onClick:j},{default:s(()=>[o(ae,null,{default:s(()=>a[7]||(a[7]=[z("Editar")])),_:1,__:[7]})]),_:1})]),_:1})]),_:1}))]),_:1},8,["icon"])]),a[8]||(a[8]=g("div",null,null,-1)),g("div",null,[o(Re,{tables:R.value,editMode:n.value,onSelectTable:v,onRemoveTable:k},null,8,["tables","editMode"])]),g("div",null,[o(je,{onSubmit:$,onClose:l,visible:p.value,"onUpdate:visible":a[1]||(a[1]=x=>p.value=x)},null,8,["visible"])]),g("div",null,[r.value?(i(),u(Je,{key:0,visible:d.value,"onUpdate:visible":a[2]||(a[2]=x=>d.value=x),table:r.value,"onUpdate:table":a[3]||(a[3]=x=>r.value=x),editable:t.value,onTableEditableMode:y,onSubmit:q,onClose:V,onEditableModeBack:_,onCleanTable:A,onShowTableOrders:E},null,8,["visible","table","editable"])):C("",!0)]),g("div",null,[r.value?(i(),u(Xe,{key:0,visible:M.value,"onUpdate:visible":a[4]||(a[4]=x=>M.value=x),table:r.value,"onUpdate:table":a[5]||(a[5]=x=>r.value=x),onClose:N,onSetEditMode:ue,editMode:O.value,onSaveOrder:ce,onCancelOrderEdit:be,onAutoClose:me,onDeleteOrder:fe},null,8,["visible","table","editMode"])):C("",!0)])],64))}};export{rt as default};
